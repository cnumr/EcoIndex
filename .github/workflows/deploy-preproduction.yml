name: DÃ©ploiement RSYNC en preproduction

on:
  push:
    tags:
      - "v*.*.*-preproduction"

jobs:
  deploy:
    environment: preproduction
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ›’ Checkout
        uses: actions/checkout@v3
      - name: âœ¨ Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: "latest"
      - name: âœ¨ Setup NPM
        uses: bahmutov/npm-install@v1
      - name: ðŸ› ï¸ Build
        run: hugo
      - name: ðŸ”‘ Install SSH Key
        run: |
          install -m 600 -D /dev/null ~/.ssh/id_rsa
          echo "${{ secrets.RSYNC_PRIVATE_SSH_KEY }}" > ~/.ssh/id_rsa
          echo "${{ secrets.RSYNC_KNOWN_HOSTS }}" > ~/.ssh/known_hosts
      - name: ðŸš€ Deploy
        run: rsync -rpzv --exclude="screenshots" -e 'ssh -p ${{ secrets.RSYNC_REMOTE_PORT }}' './public/' ${{ secrets.RSYNC_REMOTE_USER }}@${{ secrets.RSYNC_REMOTE_HOST }}:${{ secrets.RSYNC_REMOTE_FOLDER }}
